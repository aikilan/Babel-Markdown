(function(){"use strict";const N={retryButtonLabel:"Retry translation",ariaContentLabel:"Translated Markdown",placeholders:{currentDocument:"current document",configuredLanguage:"configured language"},translations:{statusInProgress:"Translating {document} → {language}{progress}…",progressTemplate:" ({current}/{total})",statusCompleted:"Translated {document} → {language} — {meta}",statusCompletedWithWarnings:"Translated {document} → {language} — {meta} (warnings)",statusLastAttempt:"Last attempt · {document} → {language}",errorMessage:"Failed to translate {document} → {language}: {message}{hint}",warningCacheFallback:"Reused cached translations for {count} segment(s) after errors.",warningPlaceholder:"Showing original text for {count} segment(s) because translation failed."},meta:{cachedLabel:"cached",recoveredLabel:"warnings"},exportControls:{failureMessage:"Unable to capture the preview for export.",inProgressMessage:"Preparing export…"}},r=typeof window!="undefined"&&window.__babelMdViewerLocale?window.__babelMdViewerLocale:N;function d(e,t={}){return e.replace(/\{(\w+)\}/g,(n,a)=>{const o=t[a];return o==null?"":String(o)})}function T(e,t){return!Number.isFinite(t)||t<=0?"":d(r.translations.progressTemplate,{current:e,total:t})}const W=typeof acquireVsCodeApi!="undefined"?acquireVsCodeApi():{postMessage:()=>{},getState:()=>{},setState:()=>{}},I=document.getElementById("preview-content"),B=document.getElementById("preview-status"),H=document.getElementById("preview-error"),D=document.getElementById("preview-warning"),A=document.getElementById("preview-retry"),F=Array.from(document.querySelectorAll("[data-export-format]")),M=document.getElementById("preview-export-error");if(!(I instanceof HTMLElement))throw new Error("Translation preview DOM failed to initialize: preview-content.");if(!(B instanceof HTMLParagraphElement))throw new Error("Translation preview DOM failed to initialize: preview-status.");if(!(H instanceof HTMLDivElement))throw new Error("Translation preview DOM failed to initialize: preview-error.");if(!(D instanceof HTMLDivElement))throw new Error("Translation preview DOM failed to initialize: preview-warning.");if(!(A instanceof HTMLButtonElement))throw new Error("Translation preview DOM failed to initialize: preview-retry.");for(const e of F)if(!(e instanceof HTMLButtonElement))throw new Error("Translation preview DOM failed to initialize: export button.");if(M&&!(M instanceof HTMLElement))throw new Error("Translation preview DOM failed to initialize: export error element.");const u=I,c=B,v=H,l=D,i=A,O=F,_=M instanceof HTMLElement?M:void 0;function q(e,t){const n={message:e,details:t};try{console.log("[BabelMarkdown][translation][export]",n)}catch{}L({type:"log",payload:{level:"info",message:`[Translation Preview] ${e} ${JSON.stringify(t!=null?t:{})}`}})}i.textContent=r.retryButtonLabel,u.setAttribute("aria-label",r.ariaContentLabel),E(!1),h(!1);function L(e){W.postMessage(e)}let g="",m="",b=!1,p=0,x=0,S=!1;function y(){p=0,x=0}function U(e){u.innerHTML=e}function j(e){y(),p=e.segments.length,x=0,g=e.documentPath||g,m=e.targetLanguage||m,v.hidden=!0,l.hidden=!0,l.textContent="",i.hidden=!0,i.disabled=!0,h(!1),u.innerHTML="";for(const a of e.segments){const o=document.createElement("section");o.className="preview__chunk preview__chunk--source",o.dataset.chunkIndex=a.segmentIndex.toString();const s=document.createElement("pre");s.textContent=a.markdown,o.appendChild(s),u.appendChild(o)}const t=g||r.placeholders.currentDocument,n=m||r.placeholders.configuredLanguage;c.dataset.state="loading",c.textContent=d(r.translations.statusInProgress,{document:t,language:n,progress:T(0,p)})}function k(e,t,n,a){if(t&&(g=t),n&&(m=n),c.dataset.state=e?"loading":"idle",e){y(),typeof a=="number"&&Number.isFinite(a)&&(p=a),u.innerHTML="";const o=g||r.placeholders.currentDocument,s=m||r.placeholders.configuredLanguage;c.textContent=d(r.translations.statusInProgress,{document:o,language:s,progress:T(0,p)}),i.hidden=!0,i.disabled=!0,l.hidden=!0,l.textContent="",h(!1),E(!0)}else b||(c.textContent="",E(!1))}function E(e){for(const t of O)t.disabled=e}function h(e,t){if(_){if(!e){_.hidden=!0;return}_.textContent=t!=null?t:r.exportControls.failureMessage,_.hidden=!1}}async function J(e){var t;if(!S){if(!((t=window.__babelMdViewerExport)!=null&&t.captureElement)){h(!0);return}S=!0,E(!0),h(!0,r.exportControls.inProgressMessage);try{q("Starting translation export",{format:e,content:"preview"});const n=await window.__babelMdViewerExport.captureElement(u);q("Translation export captured",{width:n.width,height:n.height}),L({type:"exportContent",payload:{format:e,dataUrl:n.dataUrl,width:n.width,height:n.height,content:"preview"}}),h(!1)}catch(n){const a=n instanceof Error?n.message:String(n);console.error(`Export failed: ${a}`),h(!0)}finally{S=!1,E(!1)}}}function K(e){var $,z,V,R;b=!1,y(),g=e.documentPath,m=e.targetLanguage,v.hidden=!0,i.hidden=!0,i.disabled=!1,c.dataset.state="idle";const t=[e.providerId,`${e.latencyMs}ms`,`v${e.sourceVersion}`];e.wasCached&&t.push(r.meta.cachedLabel);const n=(z=($=e.recoveries)==null?void 0:$.filter(f=>f.type==="cacheFallback").length)!=null?z:0,a=(R=(V=e.recoveries)==null?void 0:V.filter(f=>f.type==="placeholder").length)!=null?R:0,o=n+a>0;o&&t.push(r.meta.recoveredLabel);const s=e.documentPath||r.placeholders.currentDocument,X=e.targetLanguage||r.placeholders.configuredLanguage;if(o){const f=[];n>0&&f.push(d(r.translations.warningCacheFallback,{count:n})),a>0&&f.push(d(r.translations.warningPlaceholder,{count:a})),l.hidden=!1,l.textContent=f.join(" ")}else l.hidden=!0,l.textContent="";c.textContent=d(o?r.translations.statusCompletedWithWarnings:r.translations.statusCompleted,{document:s,language:X,meta:t.join(" · ")}),U(e.html)}function Q(e){b=!1,y(),v.hidden=!1;const t=e.documentPath||r.placeholders.currentDocument,n=e.targetLanguage||r.placeholders.configuredLanguage,a=e.hint?` ${e.hint}`:"";v.textContent=d(r.translations.errorMessage,{document:t,language:n,message:e.message,hint:a}),c.dataset.state="idle",c.textContent=e.hint?`${e.hint}`:d(r.translations.statusLastAttempt,{document:t,language:n}),u.innerHTML="",i.hidden=!1,i.disabled=!1,l.hidden=!0,l.textContent=""}let C=!1,w;function Y(e){const t=!!e.wasCached;x=Math.max(x,e.segmentIndex+1),p=Math.max(p,e.totalSegments);const n=u.querySelector(`[data-chunk-index="${e.segmentIndex}"]`);if(n)n.innerHTML=e.html,n.classList.remove("preview__chunk--source"),n.classList.add("preview__chunk--translated"),n.dataset.cached=t?"true":"false",t?n.classList.add("preview__chunk--cached"):n.classList.remove("preview__chunk--cached"),e.recovery?(n.dataset.recoveryType=e.recovery.type,n.classList.add("preview__chunk--recovered"),e.recovery.type==="placeholder"?(n.classList.add("preview__chunk--placeholder"),n.classList.remove("preview__chunk--cached")):n.classList.remove("preview__chunk--placeholder")):(n.classList.remove("preview__chunk--recovered"),n.classList.remove("preview__chunk--placeholder"),n.removeAttribute("data-recovery-type"));else{const s=document.createElement("section");s.className="preview__chunk preview__chunk--translated",s.dataset.chunkIndex=e.segmentIndex.toString(),s.dataset.cached=t?"true":"false",t&&s.classList.add("preview__chunk--cached"),e.recovery&&(s.dataset.recoveryType=e.recovery.type,s.classList.add("preview__chunk--recovered"),e.recovery.type==="placeholder"&&(s.classList.add("preview__chunk--placeholder"),s.classList.remove("preview__chunk--cached"))),s.innerHTML=e.html,u.appendChild(s)}const a=g||e.documentPath||r.placeholders.currentDocument,o=m||e.targetLanguage||r.placeholders.configuredLanguage;c.dataset.state="loading",c.textContent=d(r.translations.statusInProgress,{document:a,language:o,progress:T(x,p)}),i.hidden=!0,i.disabled=!0,v.hidden=!0}function G(e,t){if(t<=1){C=!0,window.scrollTo({top:0,behavior:"auto"}),w!==void 0&&window.clearTimeout(w),w=window.setTimeout(()=>{C=!1},50);return}const a=Math.max(0,Math.min(e,t-1))/(t-1),o=Math.max(document.body.scrollHeight-window.innerHeight,0);C=!0,window.scrollTo({top:a*o,behavior:"auto"}),w!==void 0&&window.clearTimeout(w),w=window.setTimeout(()=>{C=!1},50)}window.addEventListener("message",e=>{const t=e.data;switch(t.type){case"setLoading":k(t.payload.isLoading,t.payload.documentPath,t.payload.targetLanguage,t.payload.totalSegments);break;case"translationResult":k(!1,"",t.payload.targetLanguage),K(t.payload);break;case"translationError":k(!1,t.payload.documentPath,t.payload.targetLanguage),Q(t.payload);break;case"translationSource":j(t.payload);break;case"translationChunk":Y(t.payload);break;case"scrollSync":G(t.payload.line,t.payload.totalLines);break;default:{L({type:"log",payload:{level:"warn",message:"Unknown message received from host."}});break}}});let P=!1;document.addEventListener("scroll",()=>{C||P||(P=!0,window.requestAnimationFrame(()=>{P=!1;const e=Math.max(document.body.scrollHeight-window.innerHeight,1),t=window.scrollY/e;L({type:"requestScrollSync",payload:{fraction:t}})}))});for(const e of O)e.addEventListener("click",()=>{const t=e.dataset.exportFormat;(t==="png"||t==="pdf")&&J(t)});i.addEventListener("click",()=>{b||(b=!0,i.disabled=!0,k(!0,g,m),L({type:"requestRetry"}))})})();
//# sourceMappingURL=translationPreview.js.map
